---
title: A6åˆ†æä¸ç®€ç­”
categories:
  - Notes
  - è¯¾ç¨‹
  - ç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ 
tags:
  - æ·±åº¦å­¦ä¹ 
  - ç¥ç»ç½‘ç»œ
date:
---
### A6.1 (5åˆ†) åˆ†æå·ç§¯ç¥ç»ç½‘ç»œä¸­ç”¨1Ã—1çš„å·ç§¯æ ¸çš„ä½œç”¨ã€‚
[ä¸€æ–‡è¯»æ‡‚å·ç§¯ç¥ç»ç½‘ç»œä¸­çš„1x1å·ç§¯æ ¸ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/40050371)

1. æ”¹å˜é€šé“æ•°
	å½“å·ç§¯æ ¸çš„ä¸ªæ•°å¤§äºæˆ–å°äºè¾“å…¥é€šé“æ•°æ—¶ï¼Œå¯ä»¥æ”¹å˜è¾“å‡ºçš„é€šé“æ•°
2. å¢åŠ éçº¿æ€§ 
	1x1å·ç§¯æ ¸å¯ä»¥åœ¨ä¸æ”¹å˜ç‰¹å¾ç»´åº¦çš„æƒ…å†µä¸‹æ·»åŠ éçº¿æ€§æ¿€æ´»
### A6.2 (5åˆ†) è®¡ç®—å‡½æ•°$ğ‘¦ = max(ğ‘¥_1,â‹¯,ğ‘¥_ğ·)$å’Œå‡½æ•°$ğ‘¦ = argmax(ğ‘¥_1,â‹¯,ğ‘¥_ğ·)$çš„æ¢¯åº¦ã€‚
$ğ‘¦ = max(ğ‘¥_1,â‹¯,ğ‘¥_ğ·)$ï¼šå¦‚æœå¯¹äºè¾“å…¥å‘é‡ä¸­çš„æŸä¸ªå…ƒç´ $ğ‘¥_ğ‘–$ï¼Œå®ƒæ˜¯æœ€å¤§å€¼ï¼Œåˆ™å…¶æ¢¯åº¦ä¸º1ï¼Œå…¶ä»–æ‰€æœ‰å…ƒç´ çš„æ¢¯åº¦éƒ½ä¸º0ã€‚ç”¨æ•°å­¦ç¬¦å·è¡¨ç¤ºä¸º
$$
\frac{\partial y}{\partial x_{i}}=\left\{\begin{array}{ll}
1, & \text { if } x_{i}=max(ğ‘¥_1,â‹¯,ğ‘¥_ğ·) \\
0, & \text { otherwise }
\end{array}\right.
$$
argmax(ğ‘¥_1,â‹¯,ğ‘¥_ğ·)è¾“å‡ºçš„æ˜¯ä½¿å¾—å‡½æ•°å–å¾—æœ€å¤§å€¼çš„å…ƒç´ çš„ç´¢å¼•ä½ç½®.å¦‚æœå¯¹äºè¾“å…¥å‘é‡ä¸­çš„æŸä¸ªå…ƒç´ ğ‘¥ğ‘–ï¼Œå®ƒçš„ç´¢å¼•ä½ç½®ä¸æœ€å¤§å€¼æ‰€åœ¨çš„ä½ç½®ç›¸åŒï¼Œåˆ™å…¶æ¢¯åº¦ä¸º1ï¼Œå…¶ä»–æ‰€æœ‰å…ƒç´ çš„æ¢¯åº¦éƒ½ä¸º0ã€‚ç”¨æ•°å­¦ç¬¦å·è¡¨ç¤ºä¸º
$$
\frac{\partial y}{\partial x_{i}}=\left\{\begin{array}{ll}
1, & \text { if } i=argmax(ğ‘¥_1,â‹¯,ğ‘¥_ğ·) \\
0, & \text { otherwise }
\end{array}\right.
$$
### A6.3 (5åˆ†) æ¨å¯¼LSTMç½‘ç»œä¸­å‚æ•°çš„æ¢¯åº¦ï¼Œå¹¶åˆ†æå…¶é¿å…æ¢¯åº¦æ¶ˆå¤±çš„æ•ˆæœã€‚
[[å¾ªç¯ç¥ç»ç½‘ç»œ#é•¿çŸ­æ—¶è®°å¿†ç½‘ç»œï¼ˆLSTMï¼‰]]
[LSTM - é•¿çŸ­æœŸè®°å¿†é€’å½’ç¥ç»ç½‘ç»œ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/123857569)
[Fetching Title#6dum](https://zhuanlan.zhihu.com/p/136223550)

é—å¿˜é—¨
$$f_{t}=\sigma\left(W_{f} \cdot\left[h_{t-1}, x_{t}\right]+b_{f}\right)$$

è®°å¿†é—¨
$$\begin{array}{l}
i_{t}=\sigma\left(W_{i} \cdot\left[h_{t-1}, x_{t}\right]+b_{i}\right) \\
\widetilde{C}_{t}=\tanh \left(W_{C} \cdot\left[h_{t-1}, x_{t}\right]+b_{C}\right) \\

\end{array}$$
è¾“å‡ºé—¨
$$\begin{array}{l}
o_{t}=\sigma\left(W_{o}\left[h_{t-1}, x_{t}\right]+b_{o}\right.) \\
h_{t}=o_{t} * \tanh \left(C_{t}\right)
\end{array}$$
å•å…ƒçŠ¶æ€æ›´æ–°
$$C_{t}=f_{t} * C_{t-1}+i_{t} * \widetilde{C_{t}}$$
å¯¹äºå‚æ•°$W_i$, $W_f$,$W_o$, ç»Ÿä¸€ç”¨$W$è¡¨ç¤ºï¼š
$$\frac{\partial L_{t}}{\partial W}=\frac{\partial L_{t}}{\partial h_{t}} * \frac{\partial h_{t}}{\partial C_{t}} * \ldots *\left(\prod_{k=2}^{t} \frac{\partial C_{k}}{\partial C_{k-1}}\right) * \frac{\partial C_{1}}{\partial W}$$


LSTM é€šè¿‡è®°å¿†å•å…ƒ C æ¥ç¼“è§£æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚é’ˆå¯¹ $\frac{\partial C^{(k)}}{\partial C^{(k-1)}}$ æ±‚å¾—ï¼Œ
$$
\begin{aligned}
\frac{\partial C^{(k)}}{\partial C^{(k-1)}}= & \frac{\partial C^{(k)}}{\partial f^{(k)}} \frac{\partial f^{(k)}}{\partial h^{(k-1)}} \frac{\partial h^{(k-1)}}{\partial C^{(k-1)}}+\frac{\partial C^{(k)}}{\partial i^{(k)}} \frac{\partial i^{(k)}}{\partial h^{(k-1)}} \frac{\partial h^{(k-1)}}{\partial C^{(k-1)}} \\
& +\frac{\partial C^{(k)}}{\partial a^{(k)}} \frac{\partial a^{(k)}}{\partial h^{(k-1)}} \frac{\partial h^{(k-1)}}{\partial C^{(k-1)}}
\end{aligned}
$$

å…·ä½“è®¡ç®—åå¾—åˆ°ï¼Œ
$$
\begin{array}{c}
\frac{\partial C^{(k)}}{\partial C^{(k-1)}}=C^{(k-1)} \sigma^{\prime}(\cdot) W_{f} o^{(k-1)} \tanh ^{\prime}\left(C^{(k-1)}\right) \\
+a^{(k)} \sigma^{\prime}(\cdot) W_{i} o^{(k-1)} \tanh ^{\prime}\left(C^{(k-1)}\right) \\
+i^{(k)} \tanh ^{\prime}(\cdot) W_{c} * o^{(k-1)} \tanh ^{\prime}\left(C^{(k-1)}\right) \\
+f^{(t)} \\
\prod_{k=t+1}^{T} \frac{\partial C^{(k)}}{\partial C^{(k-1)}}=\left(f^{(k)} f^{(k+1)} \ldots f^{(T)}\right)+\text { other }
\end{array}
$$

åœ¨LSTMè¿­ä»£è¿‡ç¨‹ä¸­ï¼Œé’ˆå¯¹  $\prod_{k=t+1}^{T} \frac{\partial C^{(k)}}{\partial C^{(k-1)}}$  è€Œè¨€ï¼Œæ¯ä¸€æ­¥  $\frac{\partial C^{(k)}}{\partial C^{(k-1)}}$  å¯ä»¥è‡ªä¸»çš„é€‰æ‹©åœ¨  $[0,1]$  ä¹‹é—´ï¼Œæˆ–è€…å¤§äº1ï¼Œå› ä¸º  $f^{(k)}$  æ˜¯å¯è®­ç»ƒå­¦ä¹ çš„ã€‚é‚£ä¹ˆæ•´ä½“  $\prod_{k=t+1}^{T} \frac{\partial C^{(k)}}{\partial C^{(k-1)}}$  ä¹Ÿå°±ä¸ä¼šä¸€ç›´å‡å°ï¼Œè¿œè·ç¦»æ¢¯åº¦ä¸è‡³äºå®Œå…¨æ¶ˆå¤±ï¼Œä¹Ÿå°±èƒ½å¤Ÿè§£å†³RNNä¸­å­˜åœ¨çš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚
### A6.4 (5åˆ†) å½“å°†è‡ªæ³¨æ„åŠ›æ¨¡å‹ä½œä¸ºç¥ç»ç½‘ç»œçš„ä¸€å±‚ä½¿ç”¨æ—¶ï¼Œåˆ†æå®ƒå’Œå·ç§¯å±‚ä»¥åŠå¾ªç¯å±‚åœ¨å»ºæ¨¡é•¿è·ç¦»ä¾èµ–å…³ç³»çš„æ•ˆç‡å’Œè®¡ç®—å¤æ‚åº¦æ–¹é¢çš„å·®å¼‚ã€‚
[LSTMå¦‚ä½•è§£å†³RNNå¸¦æ¥çš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/136223550)
[Transformer/CNN/RNNçš„å¯¹æ¯”ï¼ˆæ—¶é—´å¤æ‚åº¦ï¼Œåºåˆ—æ“ä½œæ•°ï¼Œæœ€å¤§è·¯å¾„é•¿åº¦ï¼‰ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/264749298)
åŸºäºå·ç§¯æˆ–å¾ªç¯ç½‘ç»œçš„åºåˆ—ç¼–ç éƒ½æ˜¯ä¸€ç§å±€éƒ¨çš„ç¼–ç æ–¹å¼ï¼Œåªå»ºæ¨¡äº†è¾“å…¥ä¿¡æ¯çš„å±€éƒ¨ä¾èµ–å…³ç³»ï¼è™½ç„¶å¾ªç¯ç½‘ç»œç†è®ºä¸Šå¯ä»¥å»ºç«‹é•¿è·ç¦»ä¾èµ–å…³ç³»ï¼Œä½†æ˜¯ç”±äºä¿¡æ¯ä¼ é€’çš„å®¹é‡ä»¥åŠæ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œå®é™…ä¸Šä¹Ÿåªèƒ½å»ºç«‹çŸ­è·ç¦»ä¾èµ–å…³ç³»ã€‚
RNNæ¢¯åº¦æ¶ˆå¤±çš„åŸå› æ˜¯ï¼Œéšç€æ¢¯åº¦çš„ä¼ å¯¼ï¼Œæ¢¯åº¦è¢«è¿‘è·ç¦»æ¢¯åº¦ä¸»å¯¼ï¼Œæ¨¡å‹éš¾ä»¥å­¦ä¹ åˆ°è¿œè·ç¦»çš„ä¿¡æ¯ã€‚å…·ä½“åŸå› ä¹Ÿå°±æ˜¯  $\prod_{k=t+1}^{T} \frac{\partial h^{(k)}}{\partial h^{(k-1)}}$  éƒ¨åˆ†ï¼Œåœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€æ­¥  $\frac{\partial h^{(k)}}{\partial h^{(k-1)}}$  å§‹ç»ˆåœ¨  $[0,1]$  ä¹‹é—´æˆ–è€…å§‹ç»ˆå¤§äº1ã€‚
å› æ­¤ï¼Œå·ç§¯å±‚å’Œå¾ªç¯å±‚ä¸é€‚åˆç”¨äºå»ºæ¨¡é•¿è·ç¦»ä¾èµ–å…³ç³»ã€‚
å¦‚æœè¦å»ºç«‹è¾“å…¥åºåˆ—ä¹‹é—´çš„é•¿è·ç¦»ä¾èµ–å…³ç³»ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š
1. å¢åŠ ç½‘ç»œçš„å±‚æ•°ï¼Œé€šè¿‡ä¸€ä¸ªæ·±å±‚ç½‘ç»œæ¥è·å–è¿œè·ç¦»çš„ä¿¡æ¯äº¤äº’
2. ä½¿ç”¨å…¨è¿æ¥ç½‘ç»œã€‚
è€Œå…¨è¿æ¥ç½‘ç»œæ— æ³•å¤„ç†å˜é•¿åºåˆ—ï¼Œè‡ªæ³¨æ„åŠ›æ¨¡å‹å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå…¶è¿æ¥æƒé‡æ˜¯åŠ¨æ€å­¦ä¹ çš„ã€‚
![image.png](https://cdn.jsdelivr.net/gh/zhengyangWang1/image@main/img/20231211190703.png)

#### å¤æ‚åº¦ï¼š
å¾ªç¯å±‚ï¼š
$h_{t}=f\left(U x_{t}+W h_{t-1}\right)$

-  $U x_{t}: d \times m  ä¸  m \times 1$  è¿ç®—ï¼Œå¤æ‚åº¦ä¸º  $\mathcal{O}(m d)$ ï¼Œ mä¸ºinput size
-  $W h_{t-1}: d \times d  ä¸  d \times 1$  è¿ç®—ï¼Œå¤æ‚åº¦ä¸º  $\mathcal{O}\left(d^{2}\right)$

æ•…ä¸€æ¬¡æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º  $\mathcal{O}\left(d^{2}\right)$ ï¼Œ næ¬¡åºåˆ—æ“ä½œåçš„æ€»æ—¶é—´å¤æ‚åº¦ä¸º  $\mathcal{O}\left(n d^{2}\right)$ 

å·ç§¯å±‚ï¼š
æ³¨: è¿™é‡Œä¿è¯è¾“å…¥è¾“å‡ºéƒ½æ˜¯ä¸€æ ·çš„ï¼Œå³å‡æ˜¯  $n \times d$ 
- ä¸ºäº†ä¿è¯è¾“å…¥å’Œè¾“å‡ºåœ¨ç¬¬ä¸€ä¸ªç»´åº¦éƒ½ç›¸åŒï¼Œæ•…éœ€è¦å¯¹è¾“å…¥è¿›è¡Œpaddingæ“ä½œï¼Œå› ä¸ºè¿™é‡Œkernel sizeä¸ºkï¼Œ (å®é™…kernelçš„å½¢çŠ¶ä¸º  $k \times d$  ) å¦‚æœä¸ paddingçš„è¯ï¼Œé‚£ä¹ˆè¾“å‡ºçš„ç¬¬ä¸€ä¸ªç»´åº¦ä¸º $n-k+1$ ï¼Œå› ä¸ºè¿™é‡Œstrideæ˜¯ä¸º1çš„ã€‚ä¸ºäº†ä¿è¯è¾“å…¥è¾“å‡ºç›¸åŒï¼Œåˆ™éœ€è¦å¯¹åºåˆ—çš„å‰ååˆ†åˆ«paddingé•¿åº¦ä¸º $(k-1) / 2$  ã€‚
- å¤§å°ä¸º $k \times d$ çš„å·ç§¯æ ¸ä¸€æ¬¡è¿ç®—çš„å¤æ‚åº¦ä¸º: $\mathcal{O}(k d)$  ï¼Œä¸€å…±åšäº† n æ¬¡ï¼Œæ•…å¤æ‚åº¦ä¸º  $\mathcal{O}(n k d)$ 
- ä¸ºäº†ä¿è¯ç¬¬äºŒä¸ªç»´åº¦åœ¨ç¬¬äºŒä¸ªç»´åº¦éƒ½ç›¸åŒï¼Œæ•…éœ€è¦ d ä¸ªå·ç§¯æ ¸ï¼Œæ‰€ä»¥å·ç§¯æ“ä½œæ€»çš„æ—¶é—´å¤æ‚åº¦ä¸º  $\mathcal{O}\left(n k d^{2}\right)$ 

è‡ªæ³¨æ„åŠ›å±‚ï¼š
$A(Q, K, V)=\operatorname{Softmax}\left(Q K^{T}\right) V$
-  $Q, K, V: n \times d$ 
- ç›¸ä¼¼åº¦è®¡ç®—  $Q K^{T}: n \times d  ä¸  d \times n$ è¿ç®—ï¼Œå¾—åˆ° $n \times n$ çŸ©é˜µï¼Œå¤æ‚åº¦ä¸º $\mathcal{O}\left(n^{2} d\right)$ 
- softmaxè®¡ç®—: å¯¹æ¯è¡Œåšsoftmaxï¼Œå¤æ‚åº¦ä¸º $\mathcal{O}(n)$ ,åˆ™ $\mathrm{n}$ è¡Œçš„å¤æ‚åº¦ä¸º  $\mathcal{O}\left(n^{2}\right)$ 
- åŠ æƒå’Œ: $n \times n$ ä¸ $n \times d$ è¿ç®—ï¼Œå¾—åˆ° $n \times d$ çŸ©é˜µï¼Œå¤æ‚åº¦ä¸º $\mathcal{O}\left(n^{2} d\right)$ .æ•…æœ€åself-attentionçš„æ—¶é—´å¤æ‚åº¦ä¸º $\mathcal{O}\left(n^{2} d\right)$ 
